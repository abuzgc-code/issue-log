<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Issue Log</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen p-6">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Project Issue Log</h1>
                        <p class="text-gray-600 mt-1">Track and manage project issues effectively</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="addNewIssue()" class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            Add Issue
                        </button>
                        <button onclick="exportToCSV()" class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                            Export CSV
                        </button>
                        <button onclick="saveToLocalStorage()" class="flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                            Save
                        </button>
                    </div>
                </div>

                <!-- Statistics Dashboard -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="text-red-600 text-sm font-medium">Critical/High</div>
                        <div id="stat-critical" class="text-2xl font-bold text-red-700">0</div>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="text-blue-600 text-sm font-medium">Open Issues</div>
                        <div id="stat-open" class="text-2xl font-bold text-blue-700">0</div>
                    </div>
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <div class="text-purple-600 text-sm font-medium">In Progress</div>
                        <div id="stat-progress" class="text-2xl font-bold text-purple-700">0</div>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="text-green-600 text-sm font-medium">Resolved/Closed</div>
                        <div id="stat-resolved" class="text-2xl font-bold text-green-700">0</div>
                    </div>
                </div>
            </div>

            <!-- Issues List -->
            <div id="issues-container" class="space-y-4">
                <!-- Issues will be rendered here -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="bg-white rounded-lg shadow-md p-12 text-center hidden">
                <p class="text-gray-500 text-lg">No issues logged yet. Click "Add Issue" to get started.</p>
            </div>
        </div>
    </div>

    <script>
        // Data Storage
        let issues = [];
        let editingId = null;

        const categories = ['Resource', 'Technical', 'Budget', 'Schedule', 'Quality', 'Scope', 'Communication', 'Other'];
        const priorities = ['Critical', 'High', 'Medium', 'Low'];
        const statuses = ['Open', 'In Progress', 'On Hold', 'Resolved', 'Closed'];

        // Load data from localStorage on page load
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('issueLogData');
            if (saved) {
                try {
                    issues = JSON.parse(saved);
                    showNotification('Data loaded successfully!', 'success');
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            } else {
                // Add sample issue if no data exists
                issues = [{
                    id: 'ISS-001',
                    title: 'Resource availability conflict',
                    description: 'Key developer unavailable during critical sprint',
                    category: 'Resource',
                    priority: 'High',
                    status: 'Open',
                    raisedBy: 'John Smith',
                    assignedTo: 'Sarah Johnson',
                    dateRaised: '2024-12-10',
                    targetDate: '2024-12-20',
                    actualDate: '',
                    impact: 'Schedule delay of 5 days',
                    resolution: '',
                    notes: 'Discussing backup resource options'
                }];
            }
            renderIssues();
            updateStatistics();
        }

        // Save data to localStorage
        function saveToLocalStorage() {
            try {
                localStorage.setItem('issueLogData', JSON.stringify(issues));
                showNotification('Data saved successfully!', 'success');
            } catch (e) {
                showNotification('Error saving data: ' + e.message, 'error');
            }
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50 fade-in ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Get priority color classes
        function getPriorityColor(priority) {
            const colors = {
                'Critical': 'bg-red-100 text-red-800 border-red-300',
                'High': 'bg-orange-100 text-orange-800 border-orange-300',
                'Medium': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                'Low': 'bg-green-100 text-green-800 border-green-300'
            };
            return colors[priority] || 'bg-gray-100 text-gray-800 border-gray-300';
        }

        // Get status color classes
        function getStatusColor(status) {
            const colors = {
                'Open': 'bg-blue-100 text-blue-800 border-blue-300',
                'In Progress': 'bg-purple-100 text-purple-800 border-purple-300',
                'On Hold': 'bg-gray-100 text-gray-800 border-gray-300',
                'Resolved': 'bg-green-100 text-green-800 border-green-300',
                'Closed': 'bg-slate-100 text-slate-800 border-slate-300'
            };
            return colors[status] || 'bg-gray-100 text-gray-800 border-gray-300';
        }

        // Add new issue
        function addNewIssue() {
            const newIssue = {
                id: `ISS-${String(issues.length + 1).padStart(3, '0')}`,
                title: '',
                description: '',
                category: 'Other',
                priority: 'Medium',
                status: 'Open',
                raisedBy: '',
                assignedTo: '',
                dateRaised: new Date().toISOString().split('T')[0],
                targetDate: '',
                actualDate: '',
                impact: '',
                resolution: '',
                notes: ''
            };
            issues.push(newIssue);
            editingId = newIssue.id;
            renderIssues();
            updateStatistics();
            saveToLocalStorage();
        }

        // Delete issue
        function deleteIssue(id) {
            if (confirm('Are you sure you want to delete this issue?')) {
                issues = issues.filter(issue => issue.id !== id);
                renderIssues();
                updateStatistics();
                saveToLocalStorage();
                showNotification('Issue deleted successfully!', 'success');
            }
        }

        // Start editing
        function startEdit(id) {
            editingId = id;
            renderIssues();
        }

        // Cancel edit
        function cancelEdit() {
            editingId = null;
            renderIssues();
        }

        // Save edit
        function saveEdit(id) {
            const form = document.getElementById(`edit-form-${id}`);
            const formData = new FormData(form);
            
            const issueIndex = issues.findIndex(i => i.id === id);
            if (issueIndex !== -1) {
                issues[issueIndex] = {
                    ...issues[issueIndex],
                    title: formData.get('title'),
                    description: formData.get('description'),
                    category: formData.get('category'),
                    priority: formData.get('priority'),
                    status: formData.get('status'),
                    raisedBy: formData.get('raisedBy'),
                    assignedTo: formData.get('assignedTo'),
                    dateRaised: formData.get('dateRaised'),
                    targetDate: formData.get('targetDate'),
                    actualDate: formData.get('actualDate'),
                    impact: formData.get('impact'),
                    resolution: formData.get('resolution'),
                    notes: formData.get('notes')
                };
            }
            
            editingId = null;
            renderIssues();
            updateStatistics();
            saveToLocalStorage();
            showNotification('Issue updated successfully!', 'success');
        }

        // Update statistics
        function updateStatistics() {
            document.getElementById('stat-critical').textContent = 
                issues.filter(i => i.priority === 'Critical' || i.priority === 'High').length;
            document.getElementById('stat-open').textContent = 
                issues.filter(i => i.status === 'Open').length;
            document.getElementById('stat-progress').textContent = 
                issues.filter(i => i.status === 'In Progress').length;
            document.getElementById('stat-resolved').textContent = 
                issues.filter(i => i.status === 'Resolved' || i.status === 'Closed').length;
        }

        // Render issues
        function renderIssues() {
            const container = document.getElementById('issues-container');
            const emptyState = document.getElementById('empty-state');
            
            if (issues.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            container.innerHTML = issues.map(issue => {
                if (editingId === issue.id) {
                    return renderEditForm(issue);
                } else {
                    return renderIssueCard(issue);
                }
            }).join('');
        }

        // Render edit form
        function renderEditForm(issue) {
            return `
                <div class="bg-white rounded-lg shadow-md p-6 fade-in">
                    <form id="edit-form-${issue.id}" class="space-y-4">
                        <div class="flex justify-between items-start">
                            <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Issue ID</label>
                                    <input type="text" value="${issue.id}" disabled class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Title*</label>
                                    <input type="text" name="title" value="${issue.title}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                            <div class="flex gap-2 ml-4">
                                <button type="button" onclick="saveEdit('${issue.id}')" class="p-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                                </button>
                                <button type="button" onclick="cancelEdit()" class="p-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                </button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea name="description" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">${issue.description}</textarea>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <select name="category" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                                    ${categories.map(cat => `<option value="${cat}" ${issue.category === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                <select name="priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                                    ${priorities.map(pri => `<option value="${pri}" ${issue.priority === pri ? 'selected' : ''}>${pri}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                                    ${statuses.map(stat => `<option value="${stat}" ${issue.status === stat ? 'selected' : ''}>${stat}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Date Raised</label>
                                <input type="date" name="dateRaised" value="${issue.dateRaised}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Raised By</label>
                                <input type="text" name="raisedBy" value="${issue.raisedBy}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Assigned To</label>
                                <input type="text" name="assignedTo" value="${issue.assignedTo}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Target Date</label>
                                <input type="date" name="targetDate" value="${issue.targetDate}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Actual Resolution Date</label>
                                <input type="date" name="actualDate" value="${issue.actualDate}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Impact</label>
                            <textarea name="impact" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">${issue.impact}</textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Resolution</label>
                            <textarea name="resolution" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">${issue.resolution}</textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                            <textarea name="notes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">${issue.notes}</textarea>
                        </div>
                    </form>
                </div>
            `;
        }

        // Render issue card
        function renderIssueCard(issue) {
            return `
                <div class="bg-white rounded-lg shadow-md p-6 fade-in">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex flex-wrap items-center gap-3 mb-2">
                                <span class="font-mono text-sm font-semibold text-gray-600">${issue.id}</span>
                                <span class="px-3 py-1 rounded-full text-xs font-semibold border ${getPriorityColor(issue.priority)}">
                                    ${issue.priority}
                                </span>
                                <span class="px-3 py-1 rounded-full text-xs font-semibold border ${getStatusColor(issue.status)}">
                                    ${issue.status}
                                </span>
                                <span class="px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700 border border-gray-300">
                                    ${issue.category}
                                </span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">${issue.title || '(No title)'}</h3>
                            <p class="text-gray-700 mb-3">${issue.description || '(No description)'}</p>
                        </div>
                        <div class="flex gap-2 ml-4">
                            <button onclick="startEdit('${issue.id}')" class="p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                            </button>
                            <button onclick="deleteIssue('${issue.id}')" class="p-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-3 text-sm">
                        <div>
                            <span class="font-semibold text-gray-600">Raised By:</span>
                            <p class="text-gray-900">${issue.raisedBy || '-'}</p>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-600">Assigned To:</span>
                            <p class="text-gray-900">${issue.assignedTo || '-'}</p>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-600">Date Raised:</span>
                            <p class="text-gray-900">${issue.dateRaised || '-'}</p>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-600">Target Date:</span>
                            <p class="text-gray-900">${issue.targetDate || '-'}</p>
                        </div>
                    </div>

                    ${issue.impact ? `
                        <div class="mb-3 text-sm">
                            <span class="font-semibold text-gray-600">Impact:</span>
                            <p class="text-gray-900">${issue.impact}</p>
                        </div>
                    ` : ''}

                    ${issue.resolution ? `
                        <div class="mb-3 text-sm">
                            <span class="font-semibold text-gray-600">Resolution:</span>
                            <p class="text-gray-900">${issue.resolution}</p>
                        </div>
                    ` : ''}

                    ${issue.notes ? `
                        <div class="text-sm">
                            <span class="font-semibold text-gray-600">Notes:</span>
                            <p class="text-gray-900">${issue.notes}</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Export to CSV
        function exportToCSV() {
            const headers = ['Issue ID', 'Title', 'Description', 'Category', 'Priority', 'Status', 'Raised By', 'Assigned To', 'Date Raised', 'Target Date', 'Actual Resolution Date', 'Impact', 'Resolution', 'Notes'];
            
            const csvContent = [
                headers.join(','),
                ...issues.map(issue => [
                    issue.id,
                    `"${(issue.title || '').replace(/"/g, '""')}"`,
                    `"${(issue.description || '').replace(/"/g, '""')}"`,
                    issue.category,
                    issue.priority,
                    issue.status,
                    `"${issue.raisedBy || ''}"`,
                    `"${issue.assignedTo || ''}"`,
                    issue.dateRaised,
                    issue.targetDate,
                    issue.actualDate,
                    `"${(issue.impact || '').replace(/"/g, '""')}"`,
                    `"${(issue.resolution || '').replace(/"/g, '""')}"`,
                    `"${(issue.notes || '').replace(/"/g, '""')}"`
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'project-issue-log.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
            
            showNotification('CSV exported successfully!', 'success');
        }

        // Initialize app
        window.onload = function() {
            loadFromLocalStorage();
        };

        // Auto-save every 30 seconds
        setInterval(() => {
            if (issues.length > 0) {
                saveToLocalStorage();
            }
        }, 30000);
    </script>
</body>
</html>